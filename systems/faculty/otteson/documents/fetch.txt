USE [People]
GO
/****** Object:  StoredProcedure [dbo].[spFetchMyProfile]    Script Date: 06/10/2014 14:27:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ================================================
-- spFPIMProfile
-- 
-- Author:		Knight, Aaron
-- Create date: 25th October 2011
-- Modify date: 11th April 2012
-- Description:	Selects faculty profile
-- ================================================

ALTER PROCEDURE [dbo].[spFetchMyProfile]
	@id varchar(50) = ''
AS
BEGIN
	SET NOCOUNT ON;
    declare @strSelect varchar(250)

	create table #results2
	(
		RecId int,
		UserId varchar(20),
		LastName varchar(25),
		FirstName varchar(15),
		MiddleName varchar(25),
		EmailId varchar(50),
		WorkLoc varchar(50),
		OffcBldg varchar(15),
		OffcRoom varchar(5),
		MailAddrBldg varchar(15),
		MailAddrRoom varchar(5),
		OffcPhone varchar(10),
		AltOffcPhone varchar(10),
		CampusTitle varchar(255),
		CivilServiceTitle varchar(255),
		FacStaff varchar(1),
		SUAD varchar(15),
		ESFAD varchar(15),
		ProfName varchar(12)
	)

	-- get employee results
    insert into #results2 (RecId,UserId,LastName,FirstName,MiddleName,EmailId,WorkLoc,OffcBldg,OffcRoom,MailAddrBldg,MailAddrRoom,OffcPhone,AltOffcPhone, CampusTitle, CivilServiceTitle, FacStaff, SUAD, ESFAD, ProfName) 
     	select e.RecId,e.UserId, e.LastName, e.FirstName,e.MiddleName, e.EmailId, e.WorkLoc, e.OffcBldg, e.OffcRoom, e.MailAddrBldg, e.MailAddrRoom, e.OffcPhone, e.AltOffcPhone, e.CampusTitle, e.CivilServiceTitle, e.FacStaff, '', '', e.ProfName
     	FROM People..CommEmployees e

	-- add manaul add faculty
    insert into #results2 (RecId,UserId,LastName,FirstName,MiddleName,EmailId,WorkLoc,OffcBldg,OffcRoom,MailAddrBldg,MailAddrRoom,OffcPhone,AltOffcPhone, CampusTitle, CivilServiceTitle, FacStaff, SUAD, ESFAD, ProfName) 
     	select e.RecId,e.UserId, e.LastName, e.FirstName,e.MiddleName, e.EmailId, e.WorkLoc, e.OffcBldg, e.OffcRoom, e.MailAddrBldg, e.MailAddrRoom, e.OffcPhone, e.AltOffcPhone, e.CampusTitle, '', e.FacStaff, e.SUAD, e.ESFAD, ''
     	FROM People..AddFacStaff e

	-- replace empty userid with n_(lastname)
	update #results2 set UserId = ('n_' + LastName )
	where UserId = ''


    select @strSelect = 'SELECT * FROM #results2 ce WHERE ce.UserId = ''' + @id + ''''

	EXEC ( @strSelect )

END
